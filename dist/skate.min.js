!function(){"use strict";function a(a,c){var d=new b(a,c),e=function(){var b=document.createElement(a);return d.init(b),b};return e.listener=d,e}function b(b,c){c||(c={}),"function"==typeof c&&(c={insert:c}),this.component=c,this.id=b,l(this.component,a.defaults),this.component.ready&&x(this),this.component.listen&&this.listen()}function c(a,b){d(a,b,function(c){if(m(b,a.id),!c)return e(a,b);if(c!==b&&b.parentNode){var d=document.createComment("placeholder");if(b.parentNode.insertBefore(d,b),b.parentNode.removeChild(b),"string"==typeof c){var f=document.createElement("div");f.innerHTML=c,c=f.children}v(c,function(a){d.parentNode.insertBefore(a,d)}),d.parentNode.removeChild(d)}})}function d(a,b,c){var d=/^[^(]+\([^,)]+,/,e=a.component,f=e.ready;return c=c||function(){},o(b,a.id)?c():(l(b,e.extend),e.attrs&&F.addAttributeListener(b,e.attrs),void(f&&d.test(f)?f(b,c):f?c(f(b)):c()))}function e(a,b){var c=a.component,d=c.insert;p(b,a.id)||document.documentElement.contains(b)&&(n(b,a.id),u(b,D),d&&d(b))}function f(b){v(b,function(b){f(b.children),a.listeners(b).forEach(function(a){a.component.remove&&a.component.remove(b)})})}function g(a,b){function c(a){e.insert.stack.forEach(function(b){b(a)})}function d(a){e.remove.stack.forEach(function(b){b(a)})}var e=this;this.insert=new h,this.remove=new h,F.addElementListener(a,c,d,b)}function h(){this.stack=[]}function i(){return{addElementListener:function(a,b,c,d){var e=new A(function(a){a.forEach(function(a){v(a.addedNodes,b),v(a.removedNodes,c),d&&(w(a.addedNodes,b),w(a.removedNodes,c))})});return e.observe(a,{childList:!0,subtree:d}),e},addAttributeListener:function(a,b){function c(a,b,c){(a.init||a.update||a)(b,c)}function d(a,b,c,d){(a.update||a)(b,c,d)}function e(a,b,c){a.remove(b,c)}var f={},g=new A(function(g){g.forEach(function(g){var h,i,j=g.attributeName,k=a.attributes[j],l=b[j];return l?(h=f[j],k&&(i=f[j]=k.nodeValue),k&&void 0===h&&(l.init||l.update||l)?c(l,a,i):k&&void 0!==h&&(l.update||l)?d(l,a,i,h):!k&&l.remove?(delete f[j],e(l,a,h)):void 0):void 0})});g.observe(a,{attributes:!0});for(var h=0;h<a.attributes.length;h++){var i=a.attributes[h],j=b[i.nodeName];j&&c(j,a,i.nodeValue)}}}}function j(){var a={1:function(a,b,c){(a.update||a)(b,c.newValue,c.prevValue)},2:function(a,b,c){(a.init||a.update||a)(b,c.newValue)},3:function(a,b,c){a.remove&&a.remove(b,c.prevValue)}};return{addElementListener:function(a,b,c,d){a.addEventListener("DOMSubtreeModified",function(a){d?w(a.target,b):v(a.target.children,b)}),a.addEventListener("DOMNodeRemoved",function(b){(d||b.target.parentNode===a)&&c(b.target)})},addAttributeListener:function(b,c){b.addEventListener("DOMAttrModified",function(d){var e=c[d.attrName];e&&a[d.attrChange](e,b,d)});for(var d=0;d<b.attributes.length;d++){var e=b.attributes[d],f=c[e.nodeName];f&&a[2](f,b,{newValue:e.nodeValue})}}}}function k(a,b){return a.component.type.indexOf(b)>-1}function l(a,b){for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c])}function m(a,b){a[G]||(a[G]=[]),a[G].push(b)}function n(a,b){a[H]||(a[H]=[]),a[H].push(b)}function o(a,b){return a[G]&&a[G].indexOf(b)>-1}function p(a,b){return a[H]&&a[H].indexOf(b)>-1}function q(a){return(a.tagName||"").toLowerCase()}function r(a){return[].map.call(a.attributes||[],function(a){return a.nodeName})}function s(a){return(a.className||"").split(" ")}function t(a){return a+", ["+a+"], ."+a}function u(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function v(a,b){if(a){if(a.nodeType){if(1!==a.nodeType)return;a=[a]}if(a.length)for(var c=0;c<a.length;c++)a[c]&&1===a[c].nodeType&&b(a[c],c)}}function w(a,b){v(a,function(a){v(a.children,function(a){b(a),w(a,b)})})}function x(a){C.sheet.insertRule(y(a)+"{display:none}",C.sheet.cssRules.length)}function y(a){return z(a).map(function(a){return a+":not(."+D+")"})}function z(b){var c=[];return k(b,a.types.TAG)&&c.push(b.id),k(b,a.types.ATTR)&&c.push("["+b.id+"]"),k(b,a.types.CLASS)&&c.push("."+b.id),c}var A=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,B=document.getElementsByTagName("head")[0],C=document.createElement("style"),D="_skate",E=(function(){var a=Element.prototype.matches;return["moz","ms","o","webkit"].some(function(b){var c=b+"MatchesSelector";return Element.prototype[c]?(a=c,!0):void 0}),function(b,c){return b&&1===b.nodeType&&b[a](c)}}(),[]),F=A?i():j(),G="_skate_ready_triggered",H="_skate_insert_triggered",I="_skate_blacklisted";a.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"},a.defaults={attributes:!1,extend:{},listen:!0,type:a.types.ANY},a.init=function(b){return v(b,function(b){a.listeners(b).forEach(function(a){a.init(b)})}),b},a.destroy=function(){return Object.keys(E).forEach(function(a){E[a].deafen()}),a},a.listeners=function(b){function c(a,b){b&&E[b]&&k(E[b],a)&&-1===d.indexOf(E[b])&&d.push(E[b])}var d=[],e=q(b),f=r(b),g=s(b);return c(a.types.TAG,e),f.forEach(c.bind(this,a.types.ATTR)),g.forEach(c.bind(this,a.types.CLASS)),d},a.blacklist=function(b,c){return void 0===c&&(c=!0),v(b,function(b){b[I]=!0,c&&a.blacklist(b.children,!0)}),a},a.whitelist=function(b,c){return void 0===c&&(c=!0),v(b,function(b){delete b[I],c&&a.whitelist(b.children,!0)}),a},a.watch=function(a,b){return new g(a,b)},b.prototype={init:function(a){var b=this;return v(a,function(a){a[I]||c(b,a)}),this},listen:function(){if(E[this.id])throw new Error('Listener for "'+this.id+'" already registered.');return E[this.id]=this,this.init(document.querySelectorAll(t(this.id))),this},deafen:function(){return delete E[this.id],this}},h.prototype={bind:function(a){return this.stack.push(a),this},one:function(a){function b(){c.stop(a),c.stop(b)}var c=this;return this.then(a),this.then(b),this},unbind:function(a){if(a){var b=this.stack.indexOf(a);b>-1&&this.stack.splice(b,1)}else this.stack=[];return this}},B.appendChild(C);var J=a.watch(document,!0);J.insert.bind(a.init),J.remove.bind(f),"function"==typeof define&&define.amd?define("skate",[],function(){return a}):window.skate=a}();