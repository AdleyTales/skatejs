!function(){"use strict";function a(a){this.element=a,this.children={},this.descendants={},this.attributes={}}function b(a,d){u||(u=b.watch()),d||(d={}),"function"==typeof d&&(d={insert:d}),n(d,b.defaults);var e=o(a,d);d.ready&&p.sheet.insertRule(a+":not(."+d.classname+"),["+a+"]:not(."+d.classname+"),."+a+":not(."+d.classname+"){display:none}",p.sheet.cssRules.length);for(var g=e.existing(),h=0;h<g.length;h++)c(a,d,g[h]);return u.descendant(a).on("insert",function(b){c(a,d,b)}).on("remove",function(b){f(a,d,b)}),e}function c(a,b,c){j(c,"blacklisted")||d(a,b,c,function(d){if(!d)return e(a,b,c);if(d!==c&&c.parentNode){var f=document.createComment("placeholder");if(c.parentNode.insertBefore(f,c),c.parentNode.removeChild(c),"string"==typeof d){var g=document.createElement("div");g.innerHTML=d,d=g.children}l(d,function(a){f.parentNode.insertBefore(a,f)}),f.parentNode.removeChild(f)}})}function d(a,b,c,d){var e=/^[^(]+\([^,)]+,/,f=b.ready;return d=d||function(){},j(c,a+".ready-called")?d():(j(c,a+".ready-called",!0),n(c,b.prototype),void(f&&e.test(f)?f(c,d):f?d(f(c)):d()))}function e(a,b,c){var d=b.insert;j(c,a+".insert-called")||c.parentNode&&(j(c,a+".insert-called",!0),g(a,b,c),k(c,b.classname),d&&d(c))}function f(a,b,c){!b.remove||j(c,"blacklisted")||j(c,a+".remove-called")||(j(c,a+".remove-called",!0),b.remove(c))}function g(a,c,d){if(c.attributes&&!j(d,a+".attributes-called")){j(d,a+".attributes-called",!0);var e=b.watch(d);for(var f in c.attributes){var g=c.attributes[f];"function"==typeof g&&(g={update:g}),!g.insert&&g.update&&(g.insert=g.update);var k=e.attribute(f).on("insert",h(g)).on("update",g.update).on("remove",i(g));g.insert&&d.getAttribute(f)&&(q?d.setAttribute(f,d.getAttribute(f)):k.fire("insert",[d,f,d.getAttribute(f)]))}}}function h(a){return function(b,c,d){j(b,"attribute.insert-called")||(j(b,"attribute.insert-called",!0),a.insert(b,c,d))}}function i(a){return function(b,c,d){j(b,"attribute.remove-called")||(j(b,"attribute.remove-called",!0),a.remove(b,c,d))}}function j(a,b,c){return void 0===c?a.__SKATE_DATA&&a.__SKATE_DATA[b]:(a.__SKATE_DATA||(a.__SKATE_DATA={}),a.__SKATE_DATA[b]=c,a)}function k(a,b){a.classList?a.classList.add(b):a.className+=a.className?" "+b:b}function l(a,b){if(a){if(a.nodeType){if(1!==a.nodeType)return;a=[a]}if(a.length)for(var c=0;c<a.length;c++)a[c]&&1===a[c].nodeType&&b(a[c],c)}}function m(a){var b=j(a,"possible-ids");if(b)return b;var c=a.tagName.toLowerCase();b={},b[c]=c;for(var d=0;d<a.attributes.length;d++){var e=a.attributes[d].nodeName;b[e]=e}return a.className.split(" ").forEach(function(a){a&&(b[a]=a)}),j(a,"possible-ids",b),b}function n(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c])}function o(a,c){var e=c.type.indexOf(b.types.TAG)>-1,f=c.type.indexOf(b.types.ATTR)>-1,g=c.type.indexOf(b.types.CLASS)>-1,h=function(){var b=[];return e&&b.push(a),f&&b.push("["+a+"]"),g&&b.push("."+a),b.join(", ")}(),i=function(){if(!e)throw new Error('Cannot construct "'+a+'" as a custom element.');var b=document.createElement(a);return d(a,c,b),b};return i.existing=function(a){return(a||document).querySelectorAll(i.selector())},i.selector=function(){return h},i}var p=document.createElement("style"),q=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,r={addElementListener:function(a,b,c){var d=new q(function(a){a.forEach(function(a){for(var c=0;c<a.addedNodes.length;c++)b("insert",a.addedNodes[c]);for(var d=0;d<a.removedNodes.length;d++)b("remove",a.removedNodes[d])})});return d.observe(a,{childList:!0,subtree:c}),function(){d.disconnect()}},addAttributeListener:function(a,b){function c(){f.disconnect()}var d=j(a,"attribute-callbacks");if(d)return d.push(b),j(a,"attribute-destroyer");d=[b],j(a,"attribute-callbacks",d);var e=j(a,"attribute-cache");e||(e={},j(a,"attribute-cache",e));var f=new q(function(b){b.forEach(function(b){var c,f,g=b.attributeName,h=a.attributes[g],i=e[g];h?f=e[g]=h.nodeValue:delete e[g],h&&void 0!==f&&void 0===i?c="insert":h&&void 0!==f&&void 0!==i?c="update":h||void 0!==f||void 0===i||(c="remove"),d.forEach(function(a){a(c,g,f,i)})})});return f.observe(a,{attributes:!0}),j(a,"attribute-destroyer",c),c}},s={addElementListener:function(a,b){function c(a){b("insert",a.target)}function d(a){b("remove",a.target)}return a.addEventListener("DOMSubtreeModified",c),a.addEventListener("DOMNodeRemoved",d),function(){a.removeEventListener("DOMSubtreeModified",c),a.removeEventListener("DOMNodeRemoved",d)}},addAttributeListener:function(a,b){function c(a){b(d[a.attrChange],a.attrName,a.newValue,a.prevValue)}var d={1:"update",2:"insert",3:"remove"};return a.addEventListener("DOMAttrModified",c),function(){a.removeEventListener("DOMAttrModified",c)}}},t=q?r:s;a.prototype={child:function(b){return this.children[b]||(this.children[b]=new a.Element(this.element,b))},descendant:function(b){return this.descendants[b]||(this.descendants[b]=new a.Element(this.element,b,!0))},attribute:function(b){return this.attributes[b]||(this.attributes[b]=new a.Attribute(this.element,b))},destroy:function(){for(var a in this.children)this.children[a].destroy();for(var b in this.descendants)this.descendants[b].destroy();for(var c in this.attributes)this.attributes[c].destroy();return this.children={},this.descendants={},this.attributes={},this}},a.Element=function(a,b,c){function d(a,f,g){l(f,function(f){b in m(f)&&e.fire(a,[f]),d(a,f.children,g||c)})}var e=this;this._destroy=t.addElementListener(a,function(a,b){1===b.nodeType&&d(a,b,c)},c)},a.Attribute=function(a,b){var c=this;this._destroy=t.addAttributeListener(a,function(d,e,f,g){e===b&&(f="remove"===d?g:f,c.fire(d,[a,e,f,g]))})},a.Element.prototype=a.Attribute.prototype={on:function(a,b){return this.stack(a).push(b),this},off:function(a,b){var c=this.stack(a);if(b)for(var d=c.length-1;d>-1;d--)c[d]===b&&c.splice(d,1);else c.length=0;return this},destroy:function(){return this.off(),this._destroy(),this},fire:function(a,b){return this.stack(a).forEach(function(a){a.apply(a,b)}),this},stack:function(a){return this.events||(this.events={}),this.events[a]||(this.events[a]=[])}};var u;b.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"},b.defaults={attributes:!1,classname:"__skate",listen:!0,prototype:{},type:b.types.TAG},b.blacklist=function(a,c){return void 0===c&&(c=!0),l(a,function(a){j(a,"blacklisted",!0),c&&b.blacklist(a.children,!0)}),b},b.destroy=function(){return u&&(u.destroy(),u=void 0),b},b.init=function(a){return l(a,function(a){for(var b in m(a))u.descendant(b).fire("insert",[a])}),b},b.watch=function(b){return new a(b||document)},b.whitelist=function(a,c){return void 0===c&&(c=!0),l(a,function(a){j(a,"blacklisted",void 0),c&&b.whitelist(a.children,!0)}),b},document.getElementsByTagName("head")[0].appendChild(p),"function"==typeof define&&define.amd?define("skate",[],function(){return b}):window.skate=b}();