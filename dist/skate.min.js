!function(){"use strict";function a(a,b){function c(a,e,f){i(e,function(e){for(var g in j(e))d.fire(g+"."+a,{target:e});(b.children||b.descendants)&&c(a,e.children,f)})}var d=this;b=b||{children:!0},this.stack=[],(b.children||b.descendants)&&q.addElementListener(a,function(a,d){1===d.nodeType&&c(a,d,b.descendants)}),b.attributes&&q.addAttributeListener(a,function(b,c,e,f){d.fire(c+"."+b,{target:a,attribute:c,newValue:e,oldValue:f})})}function b(d,e){r||(r=new a(document,{descendants:!0})),e||(e={}),"function"==typeof e&&(e={insert:e}),k(e,b.defaults);var f=l(d,e);e.ready&&m.sheet.insertRule(d+":not(."+e.classname+"),["+d+"]:not(."+e.classname+"),."+d+":not(."+e.classname+"){display:none}",m.sheet.cssRules.length);for(var g=f.existing(),h=0;h<g.length;h++)c(d,e,g[h]);return r.on(d+".insert",function(a){c(d,e,a.target)}),r.on(d+".remove",function(a){e.remove&&e.remove(a.target)}),f}function c(a,b,c){g(c,"blacklisted")||d(a,b,c,function(d){if(!d)return e(a,b,c);if(d!==c&&c.parentNode){var f=document.createComment("placeholder");if(c.parentNode.insertBefore(f,c),c.parentNode.removeChild(c),"string"==typeof d){var g=document.createElement("div");g.innerHTML=d,d=g.children}i(d,function(a){f.parentNode.insertBefore(a,f)}),f.parentNode.removeChild(f)}})}function d(a,b,c,d){var e=/^[^(]+\([^,)]+,/,f=b.ready;return d=d||function(){},g(c,a+".ready-called")?d():(g(c,a+".ready-called",!0),k(c,b.prototype),void(f&&e.test(f)?f(c,d):f?d(f(c)):d()))}function e(a,b,c){var d=b.insert;g(c,a+".insert-called")||c.parentNode&&(g(c,a+".insert-called",!0),f(a,b,c),h(c,b.classname),d&&d(c))}function f(b,c,d){if(c.attributes&&!g(d,b+".attributes-called")){g(d,b+".attributes-called",!0);var e=new a(d,{attributes:!0});for(var f in c.attributes){var h=c.attributes[f];"function"==typeof h&&(h={update:h}),!h.insert&&h.update&&(h.insert=h.update),h.insert&&d.hasAttribute(f)&&h.insert({target:d,attribute:f,newValue:d.getAttribute(f)});for(var i in h)e.on(f+"."+i,h[i])}}}function g(a,b,c){return void 0===c?a.__SKATE_DATA&&a.__SKATE_DATA[b]:(a.__SKATE_DATA||(a.__SKATE_DATA={}),a.__SKATE_DATA[b]=c,a)}function h(a,b){a.classList?a.classList.add(b):a.className+=a.className?" "+b:b}function i(a,b){if(a){if(a.nodeType){if(1!==a.nodeType)return;a=[a]}if(a.length)for(var c=0;c<a.length;c++)a[c]&&1===a[c].nodeType&&b(a[c],c)}}function j(a){var b=g(a,"possible-ids");if(b)return b;var c=a.tagName.toLowerCase();b={},b[c]=c;for(var d=0;d<a.attributes.length;d++){var e=a.attributes[d].nodeName;b[e]=e}return a.className.split(" ").forEach(function(a){a&&(b[a]=a)}),g(a,"possible-ids",b),b}function k(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c])}function l(a,c){var e=c.type.indexOf(b.types.TAG)>-1,f=c.type.indexOf(b.types.ATTR)>-1,g=c.type.indexOf(b.types.CLASS)>-1,h=function(){var b=[];return e&&b.push(a),f&&b.push("["+a+"]"),g&&b.push("."+a),b.join(", ")}(),i=function(){if(!e)throw new Error('Cannot construct "'+a+'" as a custom element.');var b=document.createElement(a);return d(a,c,b),b};return i.existing=function(a){return(a||document).querySelectorAll(i.selector())},i.selector=function(){return h},i}var m=document.createElement("style"),n=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,o={addElementListener:function(a,b){var c=new n(function(a){a.forEach(function(a){for(var c=0;c<a.addedNodes.length;c++)b("insert",a.addedNodes[c]);for(var d=0;d<a.removedNodes.length;d++)b("remove",a.removedNodes[d])})});return c.observe(a,{childList:!0,subtree:!0}),c},addAttributeListener:function(a,b){var c=g(a,"attribute-callbacks");if(c)return c.push(b);c=[b],g(a,"attribute-callbacks",c);var d=g(a,"attribute-cache");d||(d={},g(a,"attribute-cache",d));var e=new n(function(b){b.forEach(function(b){var e,f,g=b.attributeName,h=a.attributes[g],i=d[g];h?f=d[g]=h.nodeValue:delete d[g],h&&void 0!==f&&void 0===i?e="insert":h&&void 0!==f&&void 0!==i?e="update":h||void 0!==f||void 0===i||(e="remove"),c.forEach(function(a){a(e,g,f,i)})})});e.observe(a,{attributes:!0})}},p={addElementListener:function(a,b){a.addEventListener("DOMSubtreeModified",function(a){b("insert",a.target)}),a.addEventListener("DOMNodeRemoved",function(a){b("remove",a.target)})},addAttributeListener:function(a,b){var c={1:"update",2:"insert",3:"remove"};a.addEventListener("DOMAttrModified",function(a){b(c[a.attrChange],a.attrName,a.newValue,a.prevValue)})}},q=n?o:p;a.prototype={on:function(a,b){return this.stack[a]||(this.stack[a]=[]),this.stack[a].push(b),this},one:function(a,b){var c=this;return this.on(a,function(d){b(d),c.off(a)})},off:function(a,b){if(!this.stack[a])return this;if(b){var c=this.stack[a].indexOf(b);c>-1&&this.stack[a].splice(c,1)}else this.stack[a]=[];return this},fire:function(a,b){return this.stack[a]?(this.stack[a].forEach(function(a){a(b)}),this):this},destroy:function(){return this.stack=[],this}};var r;b.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"},b.defaults={attributes:!1,classname:"__skate",listen:!0,prototype:{},type:b.types.ANY},b.blacklist=function(a,c){return void 0===c&&(c=!0),i(a,function(a){g(a,"blacklisted",!0),c&&b.blacklist(a.children,!0)}),b},b.destroy=function(){return r.destroy(),b},b.init=function(a){return i(a,function(a){for(var b in j(a))r.fire(b+".insert",{target:a})}),b},b.watch=function(b,c){return new a(b,c)},b.whitelist=function(a,c){return void 0===c&&(c=!0),i(a,function(a){g(a,"blacklisted",void 0),c&&b.whitelist(a.children,!0)}),b},document.getElementsByTagName("head")[0].appendChild(m),"function"==typeof define&&define.amd?define("skate",[],function(){return b}):window.skate=b}();